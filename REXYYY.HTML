<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REXY | Institutional Intelligence Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700;800&family=Inter:wght@400;500;700;900&display=swap');
        
        :root {
            --terminal-green: #00ff41;
            --bg-obsidian: #030303;
        }

        body {
            background-color: var(--bg-obsidian);
            color: #d1d5db;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains+Mono', monospace; }

        .neo-glass {
            background: rgba(15, 15, 15, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .scanning-line {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--terminal-green), transparent);
            width: 100%;
            position: absolute;
            animation: scan 2.5s infinite linear;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .tab-btn.active {
            background: var(--terminal-green);
            color: black;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }

        .fade-in { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .time-btn.active {
            background-color: var(--terminal-green);
            color: black;
        }

        .impact-pill {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4 md:p-8">

    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4">
        <div class="neo-glass p-8 rounded-2xl max-w-md w-full border-t-2 border-terminal-green text-center">
            <div class="mb-6">
                <div class="w-16 h-16 bg-emerald-500/10 border border-emerald-500/30 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-emerald-500 font-black text-2xl mono">R</span>
                </div>
                <h2 class="text-2xl font-black text-white tracking-tighter uppercase">Protocol Ready</h2>
                <p class="text-[10px] text-slate-500 mono mt-1 tracking-widest">ENCRYPTED KEY DETECTED</p>
            </div>
            <button id="activateSystem" class="w-full bg-terminal-green text-black font-black py-4 rounded-lg uppercase tracking-widest text-xs hover:bg-emerald-400 transition-all">
                Initialize Deep Core
            </button>
        </div>
    </div>

    <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12 blur-sm" id="mainHeader">
        <div class="flex items-center gap-5">
            <div class="relative w-14 h-14 flex items-center justify-center border-2 border-emerald-500/30 rounded-full">
                <div class="absolute inset-0 animate-ping bg-emerald-500/10 rounded-full"></div>
                <span class="text-emerald-500 font-black text-2xl mono">R</span>
            </div>
            <div>
                <h1 class="text-3xl font-black text-white leading-none tracking-tighter">REXY<span class="text-emerald-500">.CORE</span></h1>
                <p class="text-[10px] uppercase tracking-[0.4em] text-emerald-500/60 font-bold mt-2 mono">Institutional Intelligence v4.3</p>
            </div>
        </div>

        <nav class="flex bg-white/5 p-1 rounded-2xl border border-white/10">
            <button id="tabAnalyzer" class="tab-btn active text-[11px] font-black px-8 py-3 rounded-xl transition-all uppercase mono">Market Intel</button>
            <button id="tabMacro" class="tab-btn text-[11px] font-black px-8 py-3 rounded-xl transition-all uppercase ml-1 mono">Macro Radar</button>
        </nav>
    </header>

    <main id="viewAnalyzer" class="grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1 fade-in blur-sm">
        <aside class="lg:col-span-3 space-y-6">
            <div class="neo-glass rounded-2xl p-6 border-t-2 border-emerald-500/40">
                <label class="text-[10px] uppercase font-black text-slate-500 block mb-4 tracking-widest mono">Select Asset</label>
                <select id="assetPair" class="w-full bg-black/60 border border-white/10 rounded-xl p-4 text-sm text-white outline-none focus:border-emerald-500 appearance-none mb-8 mono">
                    <option value="XAU/USD">XAU/USD (Gold)</option>
                    <option value="EUR/USD">EUR/USD</option>
                    <option value="GBP/USD">GBP/USD</option>
                    <option value="USD/JPY">USD/JPY</option>
                    <option value="BTC/USD">BITCOIN</option>
                    <option value="DXY">DXY (Dollar Index)</option>
                </select>

                <label class="text-[10px] uppercase font-black text-slate-500 block mb-4 tracking-widest mono">Strategy Outlook</label>
                <div class="grid grid-cols-2 gap-3 mb-8">
                    <button class="time-btn active text-[10px] py-3 bg-white/5 border border-white/10 font-bold rounded-xl uppercase transition-all mono" onclick="setHorizon('Intraday', this)">Intraday</button>
                    <button class="time-btn text-[10px] py-3 bg-white/5 border border-white/10 font-bold rounded-xl uppercase transition-all mono" onclick="setHorizon('Swing', this)">Swing</button>
                </div>

                <button id="executeScan" class="w-full bg-white text-black font-black py-5 rounded-xl hover:bg-emerald-500 transition-all uppercase text-xs tracking-widest mono">
                    Deep Intelligence Scan
                </button>
            </div>
        </aside>

        <section class="lg:col-span-9 space-y-8">
            <div id="statusLine" class="neo-glass rounded-2xl px-8 py-4 flex justify-between items-center text-[11px] font-bold mono">
                <div class="flex items-center gap-3">
                    <span id="statusIndicator" class="w-2.5 h-2.5 rounded-full bg-slate-500"></span>
                    <span class="text-slate-400 uppercase tracking-widest" id="statusText">System Standby</span>
                </div>
                <div class="text-slate-500" id="clock">00:00:00 UTC</div>
            </div>

            <div id="loadingState" class="hidden relative h-64 neo-glass rounded-[2rem] overflow-hidden flex items-center justify-center">
                <div class="scanning-line"></div>
                <div class="text-center">
                    <p class="text-emerald-500 font-black animate-pulse tracking-[0.5em] uppercase text-xs mono">Broadcasting Global Query</p>
                    <p class="text-[9px] text-slate-600 mt-2 uppercase tracking-widest">Analyzing Institutional Footprint & News Cycles</p>
                </div>
            </div>

            <!-- Error Display -->
            <div id="errorDisplay" class="hidden neo-glass rounded-2xl p-6 border-l-4 border-rose-500 flex items-start gap-4">
                <div class="text-rose-500 mt-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <div>
                    <h4 class="text-sm font-bold text-white uppercase mb-1">Critical Terminal Failure</h4>
                    <p id="errorMessage" class="text-xs text-slate-400 leading-relaxed"></p>
                </div>
            </div>

            <!-- Analysis Sections -->
            <div id="resultsContainer" class="space-y-8 hidden">
                <div>
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4 mono">Recent Market Drivers</h3>
                    <div id="outputDisplay" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>

                <div>
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.3em] mb-4 mono">Upcoming Catalyst Radar</h3>
                    <div id="upcomingDisplay" class="grid grid-cols-1 gap-4"></div>
                </div>

                <div id="masterVerdict" class="neo-glass rounded-[2.5rem] p-10 border-l-[12px] border-emerald-500"></div>
            </div>
        </section>
    </main>

    <script type="module">
        // PRE-LOADED KEY FOR SMOOTH RUNNING
        const apiKey = "AIzaSyD7nHYEqv_dKPAWgoGbC6Uc4QiT3cJ-OiU"; 
        let currentHorizon = "Intraday";
        const MODEL = "gemini-2.5-flash-preview-09-2025"; 

        document.getElementById('activateSystem').onclick = () => {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainHeader').classList.remove('blur-sm');
            document.getElementById('viewAnalyzer').classList.remove('blur-sm');
            document.getElementById('statusIndicator').classList.replace('bg-slate-500', 'bg-emerald-500');
            document.getElementById('statusText').innerText = "System Online";
        };

        window.setHorizon = (val, btn) => {
            currentHorizon = val;
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0] + ' UTC';
        }, 1000);

        async function apiCallWithRetry(prompt, retries = 5) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${apiKey}`;
            const sys = "Senior FX Analyst. Provide deep data-rich intelligence. Return ONLY valid JSON.";

            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: sys }] },
                            tools: [{ "google_search": {} }]
                        })
                    });
                    
                    if (!res.ok) {
                        if (res.status === 429) { // Rate limit
                            await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                            continue;
                        }
                        throw new Error(`API_ERROR_${res.status}`);
                    }

                    const data = await res.json();
                    let text = data.candidates[0].content.parts[0].text;
                    text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    return JSON.parse(text);
                } catch (e) {
                    if (i === retries - 1) throw e;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
        }

        document.getElementById('executeScan').onclick = async () => {
            const asset = document.getElementById('assetPair').value;
            const loading = document.getElementById('loadingState');
            const errorDisplay = document.getElementById('errorDisplay');
            const resultsContainer = document.getElementById('resultsContainer');
            const display = document.getElementById('outputDisplay');
            const upcomingDisplay = document.getElementById('upcomingDisplay');
            const verdict = document.getElementById('masterVerdict');

            errorDisplay.classList.add('hidden');
            loading.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
            document.getElementById('statusText').innerText = `PARSING ${asset} VECTORS...`;

            const prompt = `Perform a high-density institutional analysis for ${asset} (${currentHorizon}). 
            1. Identify 4 recent real-world market drivers (last 24-48 hours).
            2. Analyze upcoming high-impact catalysts for the next 72 hours.
            3. Explicitly categorize catalyst impact as "Bullish Risk" or "Bearish Risk".
            4. Provide an institutional bias verdict.
            Return JSON only: { 
                "recent_drivers": [{"title":"", "logic":"", "impact":"Bullish/Bearish"}], 
                "upcoming_events": [{"event":"", "time_est":"", "impact_prediction":"Bullish/Bearish", "logic":""}],
                "verdict":{"direction":"BULLISH/BEARISH", "summary":"", "strategic_plan":""} 
            }`;

            try {
                const result = await apiCallWithRetry(prompt);
                
                display.innerHTML = result.recent_drivers.map(d => `
                    <div class="neo-glass rounded-2xl p-6 border-t-2 ${d.impact.toLowerCase().includes('bull') ? 'border-emerald-500/30' : 'border-rose-500/30'} fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <h4 class="text-md font-bold text-white">${d.title}</h4>
                            <span class="impact-pill ${d.impact.toLowerCase().includes('bull') ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'} mono">${d.impact}</span>
                        </div>
                        <p class="text-xs text-slate-400 font-medium">${d.logic}</p>
                    </div>
                `).join('');

                upcomingDisplay.innerHTML = result.upcoming_events.map(e => `
                    <div class="neo-glass rounded-xl p-5 border-l-2 ${e.impact_prediction.toLowerCase().includes('bull') ? 'border-emerald-500' : 'border-rose-500'} flex flex-col md:flex-row gap-4 items-center">
                        <div class="min-w-[140px]">
                            <p class="text-[9px] font-black text-slate-500 uppercase mono">${e.time_est}</p>
                            <p class="text-xs font-bold text-white uppercase">${e.event}</p>
                        </div>
                        <div class="flex-1">
                            <p class="text-xs text-slate-400"><span class="font-black text-white uppercase mr-2">[${e.impact_prediction} RISK]</span> ${e.logic}</p>
                        </div>
                    </div>
                `).join('');
                
                const isBull = result.verdict.direction.toUpperCase().includes('BULL');
                verdict.className = `neo-glass rounded-[2.5rem] p-10 border-l-[12px] ${isBull ? 'border-emerald-500' : 'border-rose-500'} block fade-in`;
                verdict.innerHTML = `
                    <h2 class="text-5xl font-black text-white italic tracking-tighter uppercase mb-4">${result.verdict.direction}</h2>
                    <p class="text-lg text-slate-300 font-medium mb-8">"${result.verdict.summary}"</p>
                    <div class="bg-black/40 p-6 rounded-2xl border border-white/5">
                        <p class="text-[9px] font-black text-emerald-500 uppercase mb-3 mono">Institutional Protocol</p>
                        <p class="text-sm text-slate-400">${result.verdict.strategic_plan}</p>
                    </div>
                `;

                resultsContainer.classList.remove('hidden');
                document.getElementById('statusText').innerText = "DATA ACQUIRED";
            } catch (e) {
                errorDisplay.classList.remove('hidden');
                document.getElementById('errorMessage').innerText = e.message.includes('API_ERROR') 
                    ? "The API key provided might be invalid or have reached its quota. Please check your Google AI Studio console."
                    : "Terminal could not establish connection to the neural grid. Attempting reconnection protocols...";
                document.getElementById('statusText').innerText = "SYSTEM FAILURE";
            } finally {
                loading.classList.add('hidden');
            }
        };
    </script>
</body>
</html>
