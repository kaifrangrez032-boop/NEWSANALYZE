<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REXY | Institutional Intelligence Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,900;1,900&family=JetBrains+Mono:wght@300;400;700&family=Inter:wght@300;400;600;800&display=swap');
        
        :root {
            --gold-primary: #d4af37;
            --gold-glow: rgba(212, 175, 55, 0.4);
            --bg-obsidian: #050505;
        }

        body {
            background-color: var(--bg-obsidian);
            /* Luxury Trader Aesthetic Background */
            background-image: 
                linear-gradient(to bottom, rgba(5, 5, 5, 0.88), rgba(5, 5, 5, 0.96)),
                url('https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            margin: 0;
        }

        .mono { font-family: 'JetBrains+Mono', monospace; }
        .serif { font-family: 'Playfair Display', serif; }

        .gold-text {
            background: linear-gradient(to bottom right, #fbf5b7 0%, #d4af37 50%, #a67c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .neo-glass {
            background: rgba(10, 10, 10, 0.75);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
        }

        .scanning-line {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold-primary), transparent);
            width: 100%;
            position: absolute;
            animation: scan 3s infinite linear;
        }

        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #d4af37, #a67c00);
            color: black;
            box-shadow: 0 0 25px var(--gold-glow);
        }

        .time-btn.active {
            background-color: var(--gold-primary);
            color: black;
            font-weight: 800;
        }

        .impact-pill {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            border: 1px solid currentColor;
        }

        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        select, button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-obsidian); }
        ::-webkit-scrollbar-thumb { background: var(--gold-primary); border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
        <div class="flex items-center gap-6">
            <div class="relative w-16 h-16 flex items-center justify-center border-2 border-gold-primary/30 rounded-full">
                <div class="absolute inset-0 animate-pulse bg-gold-primary/5 rounded-full"></div>
                <span class="gold-text font-black text-3xl mono">R</span>
            </div>
            <div>
                <h1 class="text-4xl font-black text-white leading-none tracking-tighter serif italic">REXY<span class="gold-text">.PRESTIGE</span></h1>
                <p class="text-[10px] uppercase tracking-[0.5em] text-gold-primary font-bold mt-2 mono">Institutional Tier v4.3</p>
            </div>
        </div>

        <nav class="flex bg-white/5 p-1 rounded-2xl border border-white/10 backdrop-blur-md">
            <button id="tabAnalyzer" class="tab-btn active text-[11px] font-black px-10 py-3 rounded-xl transition-all uppercase mono">Intelligence</button>
            <button id="tabMacro" class="tab-btn text-[11px] font-black px-10 py-3 rounded-xl transition-all uppercase ml-1 mono">Global Risk</button>
        </nav>
    </header>

    <main id="viewAnalyzer" class="grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1">
        <aside class="lg:col-span-3 space-y-6">
            <div class="neo-glass rounded-3xl p-8 border-t-2 border-gold-primary/40">
                <label class="text-[10px] uppercase font-black text-gold-primary/60 block mb-4 tracking-widest mono">Asset Parameter</label>
                <select id="assetPair" class="w-full bg-black/40 border border-white/10 rounded-xl p-4 text-sm text-white outline-none focus:border-gold-primary appearance-none mb-8 mono">
                    <option value="XAU/USD">XAU/USD (Gold)</option>
                    <option value="EUR/USD">EUR/USD</option>
                    <option value="GBP/USD">GBP/USD</option>
                    <option value="USD/JPY">USD/JPY</option>
                    <option value="BTC/USD">BITCOIN</option>
                    <option value="DXY">DXY (Dollar Index)</option>
                </select>

                <label class="text-[10px] uppercase font-black text-gold-primary/60 block mb-4 tracking-widest mono">Execution Timeframe</label>
                <div class="grid grid-cols-2 gap-3 mb-8">
                    <button class="time-btn active text-[10px] py-3 bg-white/5 border border-white/10 font-bold rounded-xl uppercase transition-all mono" onclick="setHorizon('Intraday', this)">Intraday</button>
                    <button class="time-btn text-[10px] py-3 bg-white/5 border border-white/10 font-bold rounded-xl uppercase transition-all mono" onclick="setHorizon('Swing', this)">Swing</button>
                </div>

                <button id="executeScan" class="w-full bg-gradient-to-b from-white to-gray-300 text-black font-black py-5 rounded-xl hover:from-gold-primary hover:to-amber-600 transition-all uppercase text-xs tracking-widest mono shadow-xl">
                    Init Intelligence Scan
                </button>
            </div>

            <div class="neo-glass rounded-2xl p-6 border-l-4 border-gold-primary/20">
                <p class="text-[9px] font-black text-gold-primary/40 uppercase mb-2 mono">Terminal Sync Status</p>
                <div class="flex gap-1" id="syncBars">
                    <div class="h-1 flex-1 bg-gold-primary"></div>
                    <div class="h-1 flex-1 bg-gold-primary"></div>
                    <div class="h-1 flex-1 bg-gold-primary"></div>
                </div>
            </div>
        </aside>

        <section class="lg:col-span-9 space-y-8">
            <div id="statusLine" class="neo-glass rounded-2xl px-8 py-5 flex justify-between items-center text-[11px] font-bold mono border border-gold-primary/20">
                <div class="flex items-center gap-3">
                    <span id="statusIndicator" class="w-2.5 h-2.5 rounded-full bg-gold-primary animate-pulse"></span>
                    <span class="text-gold-primary/70 uppercase tracking-widest" id="statusText">Terminal Standby</span>
                </div>
                <div class="text-gold-primary/50" id="clock">00:00:00 UTC</div>
            </div>

            <div id="loadingState" class="hidden relative h-64 neo-glass rounded-[3rem] overflow-hidden flex items-center justify-center">
                <div class="scanning-line"></div>
                <div class="text-center">
                    <p class="gold-text font-black animate-pulse tracking-[0.5em] uppercase text-xs mono">Broadcasting Global Query</p>
                    <p class="text-[9px] text-gold-primary/40 mt-3 uppercase tracking-widest mono">Analyzing Institutional Footprint & News Cycles</p>
                </div>
            </div>

            <div id="resultsContainer" class="space-y-8 hidden">
                <div id="masterVerdict" class="neo-glass rounded-[3rem] p-12 border-l-[16px] border-gold-primary fade-in relative overflow-hidden">
                    <div class="absolute -right-10 -bottom-10 text-[20rem] font-black text-white/5 serif italic select-none">R</div>
                    <div id="verdictContent" class="relative z-10"></div>
                </div>

                <div id="outputDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
        </section>
    </main>

    <script type="module">
        const apiKey = ""; // Environment handles Key
        let currentHorizon = "Intraday";
        const MODEL = "gemini-2.5-flash-preview-09-2025";

        window.setHorizon = (val, btn) => {
            currentHorizon = val;
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        setInterval(() => {
            const clockEl = document.getElementById('clock');
            if (clockEl) clockEl.innerText = new Date().toISOString().split('T')[1].split('.')[0] + ' UTC';
        }, 1000);

        async function apiCallWithRetry(prompt, retries = 5) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${apiKey}`;
            const sys = "Senior Institutional Analyst. Return high-density intelligence in VALID JSON ONLY.";

            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: sys }] },
                            tools: [{ "google_search": {} }]
                        })
                    });
                    
                    if (!res.ok) {
                        if (res.status === 429) {
                            await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                            continue;
                        }
                        throw new Error(`API_ERR_${res.status}`);
                    }

                    const data = await res.json();
                    let text = data.candidates[0].content.parts[0].text;
                    text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    return JSON.parse(text);
                } catch (e) {
                    if (i === retries - 1) throw e;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
        }

        document.getElementById('executeScan').onclick = async () => {
            const asset = document.getElementById('assetPair').value;
            const loading = document.getElementById('loadingState');
            const resultsContainer = document.getElementById('resultsContainer');
            const display = document.getElementById('outputDisplay');
            const verdictContent = document.getElementById('verdictContent');
            const statusText = document.getElementById('statusText');

            statusText.innerText = `ANALYZING ${asset} NODES...`;
            loading.classList.remove('hidden');
            resultsContainer.classList.add('hidden');

            const prompt = `Perform an EXHAUSTIVE institutional analysis for ${asset} (${currentHorizon}). 
            Find 6-9 major recent drivers using Google Search.
            Return JSON: {
                "drivers": [{"title":"", "logic":"", "impact":"Bullish/Bearish"}],
                "verdict": {"direction":"BULLISH/BEARISH", "summary":"", "strategy":""}
            }`;

            try {
                const result = await apiCallWithRetry(prompt);
                
                display.innerHTML = result.drivers.map(d => `
                    <div class="neo-glass rounded-2xl p-6 border-t border-gold-primary/10 fade-in">
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="text-[11px] font-bold text-white uppercase tracking-tight">${d.title}</h4>
                            <span class="impact-pill ${d.impact.toLowerCase().includes('bull') ? 'text-emerald-400' : 'text-rose-400'} mono">${d.impact}</span>
                        </div>
                        <p class="text-[11px] text-slate-400 leading-relaxed font-light">${d.logic}</p>
                    </div>
                `).join('');

                const isBull = result.verdict.direction.toUpperCase().includes('BULL');
                verdictContent.innerHTML = `
                    <h2 class="text-6xl font-black text-white italic tracking-tighter uppercase mb-6 serif">${result.verdict.direction} <span class="gold-text">OUTLOOK</span></h2>
                    <p class="text-xl text-slate-200 font-medium mb-10 max-w-2xl leading-relaxed">"${result.verdict.summary}"</p>
                    <div class="bg-black/50 p-8 rounded-2xl border border-gold-primary/20 backdrop-blur-xl">
                        <p class="text-[10px] font-black text-gold-primary uppercase mb-4 tracking-[0.3em] mono">Tactical Strategy</p>
                        <p class="text-sm text-slate-300 font-light leading-loose">${result.verdict.strategy}</p>
                    </div>
                `;

                resultsContainer.classList.remove('hidden');
                statusText.innerText = "DEEP SCAN COMPLETE";
            } catch (e) {
                statusText.innerText = "TERMINAL ERROR: TIMEOUT";
                console.error(e);
            } finally {
                loading.classList.add('hidden');
            }
        };
    </script>
</body>
</html>
